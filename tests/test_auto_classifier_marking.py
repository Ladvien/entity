from entity.core.plugins import (
    AdapterPlugin,
    AutoGeneratedPlugin,
    Plugin,
    FailurePlugin,
    ResourcePlugin,
    ToolPlugin,
    PromptPlugin,
)
from entity.core.plugin_utils import PluginAutoClassifier

from entity.core.plugin_utils import configure_plugins

configure_plugins(
    Plugin,
    PromptPlugin,
    AdapterPlugin,
    AutoGeneratedPlugin,
    ToolPlugin,
    FailurePlugin,
    ResourcePlugin,
)


def test_auto_classifier_marks_inferred():
    async def dummy(ctx):
        return "ok"

    plugin = PluginAutoClassifier.classify(dummy, {"plugin_class": PromptPlugin})
    assert not getattr(plugin, "_auto_inferred_stages", False)
