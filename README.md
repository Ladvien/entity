# Entity Pipeline Framework

A lightweight plugin-based pipeline system for building AI agents. Plugins are registered for one or more pipeline stages and executed in order. The core API exposes a few helper classes used to assemble registries and run the pipeline.

## Quick Start

<!-- start quick_start -->
```python
import asyncio
from pipeline import (
    AutoGeneratedPlugin,
    PromptPlugin,
    ToolPlugin,
    PluginRegistry,
    ResourceRegistry,
    ToolRegistry,
    SystemRegistries,
    PipelineStage,
    execute_pipeline,
)

# Simple prompt plugin implemented as a function
def hello(ctx):
    if "hello" in ctx.message.lower():
        return "Hello there!"

# Tool plugin implemented as a class
class Weather(ToolPlugin):
    stages = [PipelineStage.DO]

    async def execute_function(self, params):
        city = params.get("city", "San Francisco")
        return f"Weather in {city} is sunny"

# Create registries and register plugins
plugins = PluginRegistry()
resources = ResourceRegistry()
tools = ToolRegistry()

tools.add("weather", Weather())
plugins.register_plugin_for_stage(
    AutoGeneratedPlugin(hello, [PipelineStage.DO], 50, "hello", PromptPlugin),
    PipelineStage.DO,
)

registries = SystemRegistries(resources=resources, tools=tools, plugins=plugins)

response = asyncio.run(execute_pipeline("hello", registries))
print(response)  # -> Hello there!
```
<!-- end quick_start -->

## Loading from YAML

The system can also be configured from a YAML file.

```python
import asyncio
from pipeline import SystemInitializer, SystemRegistries, execute_pipeline

async def main():
    initializer = SystemInitializer.from_yaml("config.yml")
    plugin_reg, resource_reg, tool_reg = await initializer.initialize()
    registries = SystemRegistries(
        resources=resource_reg,
        tools=tool_reg,
        plugins=plugin_reg,
    )
    result = await execute_pipeline("hello", registries)
    print(result)

asyncio.run(main())
```

## Configuration

<!-- start config -->
Configuration files use YAML and support environment variable interpolation:

```yaml
plugins:
  resources:
    my_resource:
      type: my_package.MyResource
  prompts:
    my_prompt:
      type: my_package.MyPrompt
```
<!-- end config -->

## Advanced Usage

<!-- start advanced_usage -->
See the `pipeline` package for base plugin classes, pipeline stages and the context interface.
<!-- end advanced_usage -->
